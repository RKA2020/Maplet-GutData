---
title: PRISM samples
output:
  html_document:
    toc: true
    toc_float: TRUE
    
params:
  D: NA
---

```{r echo=F}
# default chunk options
knitr::opts_chunk$set(warning=F,echo=F,results='hide',message=F)
```

```{r}
# load libraries
library(maplet)

```

```{r}
r <- metadata(D)$results
```

# Output
## load_xls
*Log text:*<br/>loaded assay from Excel file 'Metabolome_data.xlsx, sheet 'Metabolite_abundance_PRISM'


## anno_xls
*Log text:*<br/>loaded features annotations from Excel file 'Metabolome_data.xlsx, sheet 'Metabolite_features'


## anno_xls
*Log text:*<br/>loaded samples annotations from Excel file 'Metabolome_data.xlsx, sheet 'Metabolome_metadata_PRISM'


## reporting_data
*Log text:*<br/>Dataset info: 155 samples, 8848 features; 9 sample annotation fields, 8 feature annotation fields

## pre_zero_to_na
*Log text:*<br/>zeros replaced by NAs


# Missingness analysis
Perform missingness analysis to determine if NAs significantly accumulate in one of the treatment
                    groups. Adjust output of test using multiple testing correction.

## stats_univ_missingness
*Log text:*<br/>missingness analysis with variable Diagnosis

WARNING: Large data frame (3829 rows). Displaying first
1000 rows.
```{r results='asis'}
# extract result table
df<-r[[9]]$output$table
# add feature names
rd <- rowData(D)
df <- cbind(name=as.data.frame(rd)$name[match(df$var, rownames(rd))], df) %>%
  dplyr::arrange(p.value)
# subset large data frames
if(nrow(df) > 1000) df <- df[1:1000, ]
# output
DT::datatable(df, rownames = FALSE, filter = "top", options = list(pageLength = 20, lengthMenu = c(10*(2^(0:3)), nrow(df)), autoWidth = TRUE, width = 1200, dom = "Bitlrp", buttons = c("copy", "csv", "excel", "pdf", "print")), class = "cell-border stripe", extensions = "Buttons")  %>% DT::formatStyle(columns = c(1:ncol(df)), fontSize = "80%", target= "row", lineHeight="80%")
```


## plots_pval_qq
*Log text:*<br/>P-value QQ plot for missingness

```{r}
r[[10]]$output
```


## post_multtest
*Log text:*<br/>Multiple testing correction of 'missingness' using 'BH'


## Normalization
Plot sample boxplots before normalization, perform quotient normalization, plot boxplot with dilution factors from quotient normalization, plot sample boxplot after
                    normalization, log transform the data, impute missing data using min value, plot sample boxplot after imputation,
                    detect outliers, log dataset info, write pre-processed data to file.

### plots_sample_boxplot
*Log text:*<br/>sample boxplot, aes: color=Diagnosis

```{r}
r[[14]]$output
```


### pre_norm_quot
*Log text:*<br/>quotient normalization based on 34 reference samples and 1799 variables: ~

*Log text:*<br/>quotient normalization based on 34 reference samples and 1799 variables: Diagnosis == "Control"


### plots_dilution_factor
*Log text:*<br/>dilution factor plot, 'Diagnosis'

```{r}
r[[16]]$output
```


### plots_sample_boxplot
*Log text:*<br/>sample boxplot, aes: color=Diagnosis

```{r}
r[[17]]$output
```


### pre_trans_log
*Log text:*<br/>log2.000000


### pre_impute_min
*Log text:*<br/>imputed via minimum value, 0 features with all NAs, returned as NAs


### plots_sample_boxplot
*Log text:*<br/>sample boxplot, aes: color=Diagnosis

```{r}
r[[20]]$output
```


### pre_outlier_detection_univariate
*Log text:*<br/>flagged 0 univariate outliers


### reporting_data
*Log text:*<br/>Dataset info: 155 samples, 3829 features; 11 sample annotation fields, 8 feature annotation fields

### modify_filter_samples
*Log text:*<br/>Filter samples: ~

*Log text:*<br/>Filter samples: !is.na(Diagnosis)


### anno_apply
*Log text:*<br/>Transformed column 'Diagnosis' of sample annotations


### plots_missingness
*Log text:*<br/>missingness plots, missing values: 0 out of 593495 (0.00%)

```{r}
r[[25]]$output
```


### pre_filter_missingness
*Log text:*<br/>features filtered, 50.00%, 0 of 3829 removed


### plots_missingness
*Log text:*<br/>missingness plots, missing values: 0 out of 593495 (0.00%)

```{r}
r[[27]]$output
```


