library(maplet)
library(tidyverse)
purrr::zap()
file_data_metabolome <- system.file("extdata", "../Metabolites_Dataset/Metabolome_data.xlsx", package = "maplet")
print (file_data_metabolome)
D <-
mt_load_xls(file=file_data_metabolome, sheet="Metabolite_abundance_PRISM", samples_in_row=F, id_col="# Feature / Sample_PRISM") %>%
# load metabolite (rowData) annotations
mt_anno_xls(file=file_data_metabolome, sheet="Metabolite_features",anno_type="features", anno_id_col="Metabolomic Feature", data_id_col ="name") %>%
# load clinical (colData) annotations
mt_anno_xls(file=file_data_metabolome, sheet="Metabolome_metadata_PRISM", anno_type="samples", anno_id_col ="Sample_PRISM", data_id_col ="sample") %>%
mt_reporting_data() %>%
# start timing
mt_reporting_tic() %>%
{.}
ix=which(!is.na(rowData(D)$Putative.Chemical.Class))
rowData(D)$name[ix]=paste("class",rowData(D)$Putative.Chemical.Class[ix],sep=":")
ix2=which(!is.na(rowData(D)$Exact.Match.to.Standard......isomer.family.))
rowData(D)$name[ix2]=rowData(D)$Exact.Match.to.Standard......isomer.family.[ix2]
ix2=which(duplicated(rowData(D)$name))
rowData(D)$name[ix2]=paste(rowData(D)$name[ix2],seq(length(ix2)),sep=".")
names(rowData(D))
rowData(D)$name
ix3=which(!is.na(rowData(D)$Putative.Chemical.Class))
D=D[ix3,]
rowData(D)$name=make.names(rowData(D)$name)
rownames(D)=rowData(D)$name
D1 <- D %>%
mt_pre_zero_to_na() %>%
mt_reporting_heading(heading = "Missingness analysis", lvl = 1) %>%
# section text
mt_reporting_text(text = "Perform missingness analysis to determine if NAs significantly accumulate in one of the treatment
groups. Adjust output of test using multiple testing correction.") %>%
# compute Fisher's exact test
mt_stats_univ_missingness(in_col="Diagnosis", stat_name="missingness") %>%
# create p-value qq plot
mt_plots_pval_qq(stat_name = "missingness") %>%
# apply multiple testing correction
mt_post_multtest(stat_name="missingness", method="BH") %>%
{.}
D1 <- D1 %>%
# heading for html file
mt_reporting_heading(heading = "Normalization", lvl = 2) %>%
# section text
mt_reporting_text(text = "Plot sample boxplots before normalization, perform quotient normalization, plot boxplot with dilution factors from quotient normalization, plot sample boxplot after
normalization, log transform the data, impute missing data using min value, plot sample boxplot after imputation,
detect outliers, log dataset info, write pre-processed data to file.") %>%
mt_plots_sample_boxplot(color=Diagnosis, title = "Original", plot_logged = T) %>%
mt_pre_norm_quot(feat_max = 0.2, ref_samples = Diagnosis=="Control") %>%
mt_plots_dilution_factor(in_col="Diagnosis") %>%
# plot sample boxplots after normalization
mt_plots_sample_boxplot(color=Diagnosis, title = "After normalization", plot_logged = T) %>%
# log transform
mt_pre_trans_log() %>%
# impute missing values using min
mt_pre_impute_min() %>%
# plot sample boxplot after imputation
mt_plots_sample_boxplot(color=Diagnosis, title = "After imputation", plot_logged = T) %>%
mt_pre_outlier_detection_univariate() %>%
mt_reporting_data() %>%
{.}
D1 <- D1 %>%
mt_modify_filter_samples(filter = !is.na(Diagnosis)) %>%
mt_anno_apply(anno_type = "samples", col_name = "Diagnosis", fun = as.factor) %>%
mt_plots_missingness(feat_max=0.5) %>%
mt_pre_filter_missingness(feat_max = 0.5) %>%
mt_plots_missingness(feat_max=0.5) %>%
{.}
D1 <-  D1 %>% mt_reporting_html(file = "../Results/Pre_processing.html",
title = "PRISM samples")
file_data_metabolome <- system.file("extdata", "../Metabolites_Dataset/Metabolome_data.xlsx", package = "maplet")
print (file_data_metabolome)
file_data_metabolome <- system.file("../Metabolites_Dataset/Metabolome_data.xlsx")
print (file_data_metabolome)
D <-
mt_load_xls(file=file_data_metabolome, sheet="Metabolite_abundance_PRISM", samples_in_row=F, id_col="# Feature / Sample_PRISM") %>%
# load metabolite (rowData) annotations
mt_anno_xls(file=file_data_metabolome, sheet="Metabolite_features",anno_type="features", anno_id_col="Metabolomic Feature", data_id_col ="name") %>%
# load clinical (colData) annotations
mt_anno_xls(file=file_data_metabolome, sheet="Metabolome_metadata_PRISM", anno_type="samples", anno_id_col ="Sample_PRISM", data_id_col ="sample") %>%
mt_reporting_data() %>%
# start timing
mt_reporting_tic() %>%
{.}
file_data_metabolome <- system.file("extdata", "../Metabolites_Dataset/Metabolome_data.xlsx", package = "maplet")
file_data_metabolome <- system.file("GitHub", "../Metabolites_Dataset/Metabolome_data.xlsx", package = "maplet")
print (file_data_metabolome)
